import 'package:blockchain_utils/blockchain_utils.dart';
import 'package:test/test.dart';
import 'package:zcash_dart/src/crypto/src/crypto.dart';
import 'package:zcash_dart/src/orchard/transaction/commitment.dart';
import 'package:zcash_dart/src/value/value.dart';
import 'package:zcash_dart/src/zk_proof/halo2/src/orchard/circuit.dart';
import 'package:zcash_dart/src/zk_proof/halo2/src/proof/prover.dart';
import 'package:zcash_dart/src/orchard/merkle/merkle.dart';
import 'package:zcash_dart/src/orchard/note/note.dart';

void main() async {
  if (identical(0, 0.0)) return;
  final context = DefaultZCashCryptoContext.lazy();
  final prover = PlonkProver.build(context);
  tProof4(prover);
  tProof3(prover);
  tProof2(prover);
  tProof(prover);
}

void tProof4(PlonkProver prover) {
  test("Plonk proof", () {
    final rng = ChaCha20Rng(List<int>.filled(32, 15));
    QuickCrypto.setupPRNG(rng);
    final instance = createInstance(enableOutput: true, enableSpend: false);
    final instances = [instance.instance.toHalo2()];
    final proofBytes = prover.createProof(
      circuits: [instance.circuit],
      instances: instances,
    );
    expect(
      BytesUtils.toHexString(proofBytes),
      "30648fc0aaa71659d5bba5e424f0c2366de02d4c2ffe9fbaa5f82f98cccda03427e841388bfc4a7dfc15245b0fa9a8dc5ea0d956d47193903e1e92158c32431a683ba812a4d7ae59c1174c2bccee8ce5a9e37428829840d43f5121dbe2370a9695be2f8c20cfaf45ad8100244a821802faa5519f18731806a7ec65d3f66a023214ef945c7337371b60b2654619da655827010fb080414df8a2e0df7475910c33bd3262742818bb846e3593fc07dceb8f87a8e7591365a08b1be5b7422e6657274b2600f5a97785c00f3dc884d62713e51839aaa72c8031dbbb9595064f8c670be2fa22d97610574880647464715ebd4543293e3f73d20d00f70cdfb0593273aed71f9cae74060afc749e448d917efdcb91f0b2ae683113cd3379e0afdaf4cc1fba7b7346d4dbd7a530735ecc35b58630e42932939c789a6a83289f178ae1a280511b56a8be2fe0a4f7e570461050b4d7604618b103a7b77db12feb070d35bb39ea0cf3978b1ede4975b0477d0c0922eedefd2fe4402871ca30a922719de30c8eeddc6f41110a5cda9b93012d238dc132941cad832e5d4cc3b89fef3ef63ede9dcc660726beae6896ad278a4d7d572fe837d03bdaf78d17ed36982bf683c53d19b3f72c52980bac38b1a9a251c98f9564aaf0a54399a189962fc8ee0188211119fa64b7ff24a31c746bc5ea36d8fb9dcfc7893e4469177398da789e57ba89080e1eee6141936fa34e100c00630f8bedfe0fc992b73a90dd467cb8f00c0753c839dbefe96aa6d7e92abb55d5a38ff330a4e4ea8a7348a999b6e8920e9864bee3283190d4a9d8143c459748d9452842fa3536eb16d548af54f5732cf697bdccf3019a015e806feeee17f0cc3e4bdf3451922eea560c289fc8d34f10fd746b009c0901a5c4348b1ae315b4bed4ef2e409968737f31871680e9ad0bb2e1d93b05321c1f84b6e74f8e390b6578df361ba48f368ed32c9ce6b86c8431faeee3c7cad5b7449b56d5f312abf9186f94d9d11d45fd01f88fac0e5be0c1a008d2bfdda36b23a5eac7e2d219f9e0e2d13a54bf88604582f951727605dd2663b7e44f94efa3b7366d5916cfcd2266400f119b953c7b32aa0b06400da4124b92afbfe1d8a0ee20b5a36edc71430dfe1cfca8ea1f2e20d57e0f83678e1a4f77e68eb87fbb61cb0d87e42b334e8161345cde4e9373ecfc635379ec8694b2c3ddff86b75eef838da1d426fc56263da9faaa442c67dd3e15028f7af25bb033f871a6d8f23e53a921bfcd61acf7a305100040a176b284e1caa7b5dd4def5312f772abc4f4cae0d451a1b8dc4e0b1ee18b93ca0e138699831945d673be567ea3bbd6b492175eadfa0c9fc3f81b5fc7d62ba7d1ca8966f5a01b40dc21bab2a5d82dadd8d87e61dc1defa0a9e3354ed27366c2e36c1d1f75c876aea2b2880628cc69440dfc856e3083cf2f2404401cb1a7dc066f0c1dcd98a6248df744314eebb5242b722eb4359c31bd302e03f82545329d08bc45dff91a64a1a976cf40ae8994f141605c30dded29d625b835e6eddf62ce1b6d37da536db672f6986930285d10c01f14228c613768cf0022bdcfc90f724aedf8cc96cd71ff8226269d0ec5c71dff5d1a7d7d93f1d2db38520240f4c1cb8fd061c6fea074251eab1a153989d3f849230ce941df9c24bd181066606087f5b1c1e262aadbfd1f613c97c29238fe89879a221a85c5aec1ca1ee32bfb2b49328526fb89337f3cbee09550b3fba222ab05fc00b383eded80cb3f1105ca84670acc0b53a1fc12be31caa3bcf35f11f7f67f490b956dd2a22ad70f144216bab0d13264e2ca2d04afd9a1397e5fb07a09c2f34e430b9ad6ddc8e5313c6d447720a95092f9e6bd557b1459481c8bcdc048be7c7fca3b43238fb6e01b38d7b0cb3a61798395277331d7c133bd6ec8e5639e5ca0b84267e90164d45f0516638cf3b77575c24168f089a3d411f9b554025c87286cd6fb2a8e99db64ec20f71ae77b1f878c3567b987f81c774828e22f414ceab4257f2df194901a70dc150a45c75a98537b8fb9a1000e491d64797f4a430555095cb03b174429876f49081712ab3d39fe8874668829158dc0a9545a8cac76d872206306fca2b3504e71210fb0a235b2b8025d4ca330d30f462e0b7d4e45b7c5dfb71b528d2bfe57c4ac0661c3b441b1072b0e73b11f87e325cf844f3188c67ae709ad6ff3aef2ba14d30655cc9a7a6f4a9b821bd90b68645feec35e9d942f9b54cb5e8a3d941fda0c183c12deea86e485c82996fd8cd72bbec1c59b87ea359073fb757ae09cf47c6ed81a1aaaa6a19a884674431c8c6a9ba088539caa71bec8fe5bb8ed3cee93445fbd3ebdb7394586b76aefcb932d544c65eba3de4b3bd0703959d22b620b17a7c01f342dbfea198a2eabdbcb54e35da2237f59e16085d22f66853d6a661773b3a8420711dd65684166cfb140a91546bf3b2e85fdfea7e9e52b06b9e61165205b11753fbb428c4a1e9a96960ee0c7fbc074fe7ecac70e1dd30a0d1d94ad2654104cb32f4f3ad006a859a7361e5203fc0c15254f7ba9bb4f4324a113834b911046c5c312b65b0cf0b5a66132f5659c6a8d0b8e9b681add79ff4b46229a368ee5a69648196c09d958a3790dc121004fc501618d7f376d2f7ca74d556ae4110633d8098938de64f5eee98d73d000c229d5aa45202c6342f09ac52c42d9847ebec4c9e11005af830837eaa032ec0d69d88800546d949bf77eae5b599f5c277da419f50b0b0c8e05ca1dc16e38d6e120ca6a3106fd448d8dc5de10fa143f0eca39d34f1c0731aece754e0ff01e2c068680aba69ca1681481d441571fb8c095a386580e1a3e09a6e136832c3441a96b841e7382e2edb964bce8aee936be82a3d6000135f30d14e76c5ffdf2246042ab05e21307446d82d64aac08f63bcaa32f1000ac784dc210f0512c63bfb4acda658616abe6ca9cd588fd326d79ec16c2134869eccb48e31c1765a216a257ee704c0c3233bbf5b02f991069914f84489ebbb0716143b6011a302730f90bd31ee0be767f0fec9e5bcfb09214b881e2ba80fa6720379abd882bf2e63ea909cecaed1384c19a37a108e2d8ebe8801ad1b006de10123652ec1e047f88096ee260a7e01962d685c4ebc5001c83dc8d40347371c8c7d8a1b51c211282d2c73c63b67f0848b627a0b8938da4ab6a5a715dec66d37b95436d053c4b323c771958488d05fb89fe454c048a161869d27e2b6ca36c1539cb1fec1abf4e04006c057956c4609271a298ea3526916d37ea82a87cbe4c2562290c27821d490f71b01e4a2b9c6269161fc2d09b510680746847cb1cc126ea8fc8b3e82a2d1e2dfb9b81ca2bd20abebdc700bdd01c103961e3986c54101d2056c9c5bd3725c429fcfc06533ec6a7fdfe3ee07f926a4cb4eabe7cf1404f6362200df2254db2ca3e25928a2e4e5b53571b3ec89dcecb4618d7690f74da0fd518be63de7d8bfd331e6a9caa518728a8695f0334b2694d256b3878183d59f5ec296d494656b5a9e422659693bb02e2bb54d31fefb70955360fb74d8f217121693468be1ee11f1cd03a2fe56af8d17aa1e08d2af228f966a9587f8aabdf65ac5c6413e729972b72b43e7cfb239312fc7ab22250a2500bc55ba1fc5d647152939b022bd85b4263cf4810d958a4c5afe96a8a5aea5432fb89d08bcca831b69d349d3fd772fd22e9334a1e6e569064eb5acf947dee928407d51842811063c8034cbaad4339780fc4012701588d47dff82e1e269ab417c755105100ec8502851b06398a2b25a5aaee7fa923ddcab277160fa518790a30fc1459e4b18d7052a84edcbea590e6395bea05e41c5e9765e4db5efe8343fc278472d302b1076028f4c6a538e742883b4d2af0d339fc1125bb1b4f5784bd7427c1e50b7af3b71087a0c6a31fa1a8707f92f1cb541e894756c8eb766a74227c3f296f89171325aa2e04da3dcdb2eb46082f3c0292125c4755129e510edc0057c49b8cd2dee77b405f1f087e5b33b43cc36a7b6bd4255f53bae5284c9816da465330ac09b489ed4fc71b613cec4b6c2c67d2a7985b113725569471cb82666f3946e11ddaaf2998ef1b67cb4a259572a2c4bb7cffb7223688a74fad892928a55c75f10bb0d9eb83e37a0979eca04ca50081feb542283fd486d629b99e7ce9476e7741abba5cb8aef1073ec594e4fa2c5bd37bf63dcb3818f05552ac3b504b4e33602d90b76e6043abc4319c3ba00c1e91c271818f7e1bf8a3e9dbd268c1a9244622ac79efbb0e6d6eca1acbb38cae4c2e16d8a5065a00d32cbadb6ef6918bd9dc29c12a8ef823240a978ef0ce7ff24ccabe5952b6910d2d26a7232924853fa8f229670dbdfd35411f17c7530a9ba8547c2ac2bd42c62b50d03b25172998edf159d2c319c0a6de1bf441a5378725c3b8192e30b3593a2d7b4fa0dec8070e6ac146b57f13181fd91ec07804bdf95be482e2a5f2203f280807c3da949ca0ddcf89c28eab900e3235b3edddbee610a7a4b8b8d90ea170102e2aea2b103ad0e313e3d9bb5b18ba94f4a011c55e8b8ccb0c5a0a960f720639270c0b2abee72cb1a61123c25747dc23441f077b74ee557e6cdebdb4cc602319120f8e26363f7e739a7291ca1afb8407a6190cfa2215b0b15b2a09f888d21a7f0f804721e8218c7f723dd53004656d9b5ee31a1221dabae3c776865f8ddb08f30d257a3349d02ab197a6dbb5a9bba031ea857fbe790c4b919dede0cc74858ca825e9a8e1bdb9670d163ce4f67ec793776ad3f9896a43eab01efeb7e7505889e022bdf9ce3afc413f6118a2f980846e100b79e64281b703b50a5e8803f6eaff2c1c877f1b3376a5de9476bb8f4db83ab426365d985639dd6f7083bee6b67c622f07d3aa6aac24cfb070bbcca7bed0c195cdb9bf0e608ab6a09a99a787fb311a6323ccadc7bf97870628b1f6d3213c69ce77f133f844a66d2e3e252f39101dfda62cf2218cf8f0be41e5b1645f727abc53876597ce9ce3c30e2ac38c83676bb57b2fb3a633cbf429bf2018cc755446cba4b51611343b86ffd7ffee597b880e954b3de209ed4d87d31cac699dec9ecd3b5985f6839f162631709d0019efcaf7ccf92ba69286752847e3ef818c3b2bfd31821bce9d16a4203cda3a7f3aff55f9c90923f987e8eb92a77d8b96de03b7481b03fbf99ce8b179da695f3e1ffe783225e03d0ca3817bb0294584cb960cf851653ae120f473f17833db4420f05d93b4c1a12ec1bcd77d6d88512c965e8a2a2b466337a7a3a949f934f2d5e15374c303b739279887406a189e888803d4acf8cbf55e9f09c2f958b50d9c6a2fbbb6562dd92b204463aab4985191dfdbffb2d31b42a751cd6988fc149431b8b1505046ae91e6233ff320277e2ef72508f8ac5d1d7a4774bf1da40627952adae423656de89049331c8dd6cd574b3e83208ec01fa6a56cf265bd87fcbb9368e7a692d60dd85b2511d174288a974cffbb603d18054b9de93ff047040348ced0809b2e88ce4fd71322235192b7d09aa787245e5d92968e405a4d7c8613439f2490fdecdf5065ea290e71f789c8e43c55603cb83a956ddd59c2df94c73c13bce080a05937bcfcd55a1f74ccad879e594628b40c53903e05546272f123fe2d63d10c4319174901661f06bb0f16be4ddbb271f1cf360959d203d5f253a251fa5cd7867b3f6fcd24837d1f147ef85ae37a1f240b9f5b70f5811ac6a0408a5166eb06768c89d9085e90d205564c0999b02ead4bbd1323f332145bd3f58bd923412fac272b4369be72b4fb054c0eae3c8d3a83c66b15742c5f42d2e9fb9a6c50fd725cb8d3817eeee07bd807ca779ca7e9ed6f8e4b42af0df6ace47e9946090dd761495af3decd216bc02e02c178ce3b0ee02adf7085599a9b37fea5f46e85308b1ddb6a09a45cc07a7dea174a1e7ffdabf43ae38d812eee9b4105b3916de6f0c0928c1d3bca6a96dd5c6e2767e5b41235b0042bda7cda2de313248362619bcae30d4f8880c00512e3136b93be9db269c52a9b4f920e1bb548372e2fccb08b02cf3e2536fe36c17433d64c11764ff073c38d23b76dd65121ef72a912948fdbc71a608591043a4e673a99fa052f8d096edbe5894cfc95367a7f4a8bb387e0c1522a90351bdd915cde71a87aa40581a51c498e5d6fea7ea1737b5773579b71d9c6d4ccc360967640c388a138177969448a34074ef0bead7166b75f06ada64dd1fe2307e4ef869f9bdcd247a02b78cb5ffcae9deaae62dd37f0779a0ce24c5cbbc8890628ad244ba0526ba622a62583b900b580a9cc27acc236f6d947865a7ad9b2250977944657679f5c8a8086fb60b5dfa477ab9de1f3fc56c138f6fcf8f120157ac93868276ec2e4f4d3cc1957c20385e3e28b28c1073f7882121499522466d3c028e3bfe5568b98530cdf3bf1754c5af48564f8afe8e88d563d468c0281a6263260017ff64020ed9d84fdaada64c37449f226df951b63e926d588f279709a48a3771e7286485efa4ee6048bc56a6277118f9c7e9c7b6c1984f8441944e0807161f7812cc075ad8b1a53981adb1b89e066a2fd8f32fbe88cdee04dc14061b3083f0810ba2307e8db5894c2b54dd26118c19945e12f6268dba00835367fe38b968f0200c98150f037b875642bc899f6444d4987b6983bded966d7745ba3b269716550693c512f0b20001f9091feb6dc1540dd30c6906c816689ed893dbdc83f60efffce31c2ea312a576974b6410e06f35e7dedf662d23af90641b55a6e26d7a0fe693142cb7405be7e2cff398fa184332ad02b4722041df13b3c5d1c6eac896f97dea59fb6d5b5a94691d688a2133d598e430d6d9e4c7ae231c7459ce5062dbb49b470c505dc434ab9d466a6f063ac730628b10e15cc7b1acef2b630724d06184cf447d26e88fcd0fe7d98b9895057f0c048e63cd253ce50d3932e0515478ada28ff71c0eed5efcac094b3302fa66321ba8d36104bb540157e954925927b575ffec03768cd94cf7989ff053fd81a0123f38052ea51f6ff68dd72936dbc8e2559f269bb8c7997a41b77b9d7179ff528692ddee12aad09ced38cf01fb065c3fed8347b215d802ed59a0a74581c",
    );
    expect(
      prover.toVerifier().verifySync(
        proofBytes: proofBytes,
        instances: instances,
      ),
      true,
    );
  });
}

void tProof3(PlonkProver prover) {
  test("Plonk proof", () {
    final rng = ChaCha20Rng(List<int>.filled(32, 14));
    QuickCrypto.setupPRNG(rng);
    final instance = createInstance(enableOutput: false, enableSpend: false);
    final instances = [instance.instance.toHalo2()];
    final proofBytes = prover.createProof(
      circuits: [instance.circuit],
      instances: instances,
    );
    expect(
      BytesUtils.toHexString(proofBytes),
      "42102957f66ccf566f6f9616905cbc7f5a71445e248b08188cdd52b598a3cb9cd9933f5d50244adcf58b685ee32649f26c1ed5201ecc6761d81011ba811a092ce8cd9f259db97af7b3f84051000d4fc13d0b5e60d575d343d5d02e5bfd7c383d8abf1284a76c46287806a431a6037c025caa33c1cc6680a27a27e43f9941e590d5028575e9fc1a18357967e5c75c743b5df1bc4a20546bba8c010945f5ff191301754814a3256e303322582039a4ff1af34bfb2758ad0d9357fd1245ce21912afaf9d31c5e9af4a2c75018900016d524551e19070ea928f494e9fe8e2b027c16859f773c908e7827200c1bc0d3a29ca346bd6429efb604fd3d1712cd99c76037c1024994fb1e35d8d5d798bb11b0695a92b2bc9cb52bfb5f945258eaadb628ac2546d4548a7314aae1f12875c9c404ae97baf44ce67777f1d588b877c2acd23c087cd01c03ce7db25b76d3f002bb185a79fab3ef6e90b106c7e8b76793164810f4282393115380cdd17913074468b8e9f9fe3918a893baf3715f686f8826a22ff6848c9666d3aa1613f3a652329f507b9984a7f744b30775cc26fcb9c7fecaad3d8d6570dc12822dbd30b1cdb7dc56f3a29151718d4582434fc140bc6fab7f92db8a1fd617ae628dac5aa4544cd5c3bcde569269bbf1ce55bbc028f67218800d42dc30e33b21778864049d1c6cfaea596ced0dd60832f499d41eaf5a00fa0086f2354d7497b82fc6476e4ba863c3ff25d0e255315781c3e15e91887217c17d295694abcfa35695a70124b35b1da64e6d7f05c237740a9c3e60529ead6b072183b91c3d93b4c666ba61b56e42c5a12f1465d8f1e5d4702988ea6ffb01ca0a0d357018a8f2fddadfb5678b745c51bb31bc211a23f31f42d17cf4cee9a860622c32839ee272d96152636fde4ea7727474c4dad5a367e4368b6a35b12131d7a8ae344fef5e0009ea199359f6d928bc397639ec228ddbb52a9e17ecd6e2f9488ed8027ef7b8831892cfd44e91c350f95ecb590f722a24aa13f804b44fb54b798c1fa41d04fc41f1afe901fd2862da2fcc6cc9fbb1306e45ef03803514080be3dd7e0abf9eeb0223d436f4ec5072a43c58d237a06c801cdf4bcbaae1bae5a2c436362460d2255327be51a8dc88284a18f55156689453070fa495f8cafec662fb713601a1158e8262623ba8ed5476f6d9c73dc0b16a0d1cdff921ebbde177e310c7159bfc07052ad0b18027944fa3adc5b8cd6d8ba94ec68a950ef6a69eed9b1b256e320ca78be9ed0dc31762a2458482696e22f4d75baa8dbcc32830650e256f60a99d3038faf2f88d0e363fb9d189ea0a9a3fe1bd4c11e2cb6106331096c17ab434b6909e086f00341e610cff6e485deaf11fd72d6d1e1d07e8a746149612fd07508e8888b20dfd8d0ad9fba4bb95fcab323a5696e718ceffd453b563e7ec39d7d53b96f6292b11a7bb25f0cc27ee15d8a184416075eb4095d5974601d09cf563bd25fa6662d686c72808d6ee7a750b977212f10acf034fa17c28a6d9c9e23721ee34527471d464bbc9a49fd1e73e4ff1c8ecb2c91c731a1f5807235ce8eea9cbb014bd8275221673bd809b70d636ebf621700a14f74cf4368da765aa195122af5c1e8b1189dc95b47d1512320feeb1fb94ec01e543961cc20daf5df2b98f59a39129b605677b59885cd4bff37bc92099a0032befe21a1b37ed92cd02bceafb6cc80e490b5b6710ee0f8b3f75f5a2632ad6952ce6c4ef77d4f565a1a4140549dc0925b52094c9f67a74814ec8d74c23a6aa0822c3d9f0771f711dc915589745e3a33c0f2f5ee59c6403b96b33703f5fae199b28410962297aa44581716f4431b38e3649302aaab60de8f2dd9cb91fbf3c3a9a382d0335b41a635a054ce07d6d6f993946babb73f385b5b708c0906183ead153c2efcf4bf74d2606eedb7cdf7461ce1d6b4b85699e82a6636a6c9445b39615998ea01822510aad2d437c8c7d85463f3cf8de1ebb822a4c7bb3a8928ad48a5ab539ba8c70887fcad0ad8a5954af3cb33116e69bec7a475e560de2d859fa64db020c207adf8826deb07b811d24a8f1f81d86fa07b2f4490d2e717e1169ca7cfd3ec7ece6b958436e66224d23e51cfe24147b323ffe0cd82a727df12cac7be79f3a399e6a74cce26143190b565f8c4c36054aa250c65b2cc2b8b6ce76ce6fc56ff73faa567d7862f047c4c92e45164bb417a135d4cf32a37183aaf8224a8265e0e62d01b0fd3c612b5dd69f0e0f7ba1141f1e0fe200d2eb527b4e07cf77ab209ea68a807a408be0314bb17f7af3c05a4a3217c423b49403f48be367ad64dd98448e801e4af678dffffc91e88cedf245010d91465a676fe07d1eb448d56575db93d050dfccc16261d8772e5e2509a9e43d1f644ee27f6651efae72eb2be2d8a514050294923d7e8c7e68a37853751bf6541eb267817010bd90cd8eff19a5dcba50e5bb246f11094042351a0c69047e1f7431589e720bce319e1122eaf39560628e35732e067ade39049c1ef53f68a4989c0e2dda02be7572621d69faba882ef341ec080c809a60c642e1616770d28b27f317eeebb055332eb715ecf840cdf2abd5b2f06ec42f8e7d5a31eeb16978e3a013004fed5721f99f1e57a89e8e10d1ac3a18b678559d14cbfa5a55efc81738dcbd004ecff7d7a06d0964a406c2e8ef0d57f442e5e27950ce31243b8b384af64c7d00a10c295079307f9fca13e48070159a45ce77d161ac7eaa9e9aa21d7da75795176420ce256fca932fd7f28b2929ba5590ae45417a458151c84068841d38ddff1e9ab5bd699e1f539c50c6e099671abe4d7c464c9d269b45c6847ce0b19308f3063b44663dcf6f971ce1d59d69f1a11bace26864a051a6165135d19233d116823d6a22547b9fb5b31dd4dec80fdb57b40d623715a91ef42fbccf374d7cf21b7910b836942dbceccc13bf3e5616ea3b5ba2d151e85ddf58dc8f9976b22829d4d430ef0458157473eaec646c189e0ff1fa2f749cc515a0e468d944436a51cfdd200a12d0820cc1f4408619656824432afd560dff431b896af191bb2ce77cfb4bc3335e2de2abf2c2fdaffa879ebb23624b8d475cf615f1202986ec1a8f9b9eb01419368a1ccd9e0b4caad9f07d93166bb7616bb4b503efeac11676dadbfe71f15133a48f79704b4b77b4f2ff9b497aa68c1c4d0caa3fec87ba6bcd9fc81e6cfc5c2099a542c37d164ec54cf9a8d3413ac15055929cd135b892dbff1841df6d1c4c39e4ce677c18fb7664b4054f9a9066086e65fb418a7c8a628c8f88ed3e0b5d280680ccfcef1c7b332f5e59a94e34266ba35afdb684c8888486a095147cfc501d17e0df5db08be9549e887f7a735d1e9596bc4b06d2f7b6b2fb2bada5b07913cc3876b603c9bcd799b01df11d1fb009589956d334b86de4b40e71b89800d958720a7f769fcd989932ebb1f21250b203cbd92b686a07ba20bfeeaa64b55accb85c34fc566235ee58bed6ec324763a0015efdce762401056ebbe7ae4de2195ec33a1ddcf721f222172042e98e919568a1571652b5fb0bbce345c9c1b2f66104a88b37a7c6691448239838bb715e3d39f3c7078f20d8900761b0a76f863aa269f2aa340090436aae1fe156d81b531d52aaaf647db869ed46b123a32a6bab323809d42af0f27ac835b3fe058e5429504e7ba320d3f9a2faf527b0be83ea632f17de0f12eecb57672866d281a60852d05f3720837bc374e7663146e92bff9c1e7cfd493341f7c4f315da78c553efe5061dfdec3f98a63c4044891e147e943b37e80eb9112c23de62c05ad03515070ad654f7e388cf785dabb906d2d698e96a4ec3032312711e3a4e5c8a65e540546a034e621972dbf94f2a83a01f3fdfa84399e08f943fb46a80b57f89a913511c08d9db5d673f686410c4c6ee2627154757939fa78e0650fc72342f1654f6692d85b783bb71321abd503cd61e98d329195bd854cdd61ec7e510880e7e7b45589406720a488d0f00e58b8f1595f5ce7d2b201d809aca23a7ef49d27f63302aefe12e54d5909350654d4b4c69058277f3546aa6f9e23f02f259733f4a62d717bd96920742fc21419a7b9dec7da8e9c5573132be7e52b23b4329f21f6caa9aca4a858f14d49b996aa1da6a382e3bdc88b09f93a2610fc015777ab7c4f5cb8ea4532291ffe61d65da5a794b8f80ea8fbf8e113b1e6881b33126e6ee9e73085e20ffe8f1729b80aff00eeffca29504792910f925a99daf33379ac215d45677c04c83b25074bc9ff43dc238843c169d18e474f2001e53a03502baa63919606147a3f2b7a062087012928e20ed6d5f21356c75525275a0799434dd652a5b415e876aba702b36f0c213ec9aed40d36bd5927ea91dc838e9116723640aeb058aea470b506605061b5f91f4e3c1d24e5218649c7d9d7869ab84871d151e998d9025bf229689c62b4d2d8c40a53c7745f929a84bea4620707b54b30d45378549c56bc1ed7f27a8bae6753d56cc55528b5c7d38aa4825934e3c12ca39cf7b6319524064908fd13b23c43c390295d5ef6b12fea6be478be2e716e4553942eac2604aef1f806be2eac8c67b43935d0e1d855a3418c6501417d75cab353e0a5ed02617008874062647d86661174015831f0c503993aa257c66b0c321b912c9d2eb60cac7a6bdb282f182617bd8715bedaefe7a72e36640c555894d7b5f11817d8e1606636e67694fb818b34533562a76b6297ca0ef0ad221a637bae42d3e015e6cbdb4e57ef947a830343a110b64f4103db9741c3d39cffaa8cd654e651ed48f64c40f59a247f3036366bec4b37bdc86dfce970805f73e77f6edd92b30211dafc4432bdb2a931cd9e6e1cbfb916ea041bcf33b4efadfdad07240c739b5333f2ab9c30aa80c6de58c4abe5ac7e973a1467909d7505fe1a4bdcc65eb7db31b98f5455ee50a2071201ebb6d455ab3854572d7a1b3b39fdb129ec116ccdd01135d4dea8539f209e89a818493945b6d682f17a1b56d3e9ce760a7dbe7c00481145af91baf3d4584d77503981722b5a27d7d4d70f3eded8e43005e708c7fd03d37274f1d0ea379de68dc94fb40d7b7b53b656af5c93afaa934901b98b2fbe54412df1a2aa1894d58957b09e43e1deb1c20f6ed309eb3fed784d01a83edb2766515bf0c01b4f7a6f0286a7df36c313e7122b96f8dac9c4434fe24fa383c6e1cd509be52deec6569233e7d874e5c803b113b1b8f9108e177084a99f47a920bfcf424ee212b2bb0e5d34b80164459e8d2fbaced471d4fdd4563b1c0e041bd7e06b53720e01ec3fa089be7fe9df02fbdcec8ffe1d973e6dc4d1f4845e122c43501b416e41f4d7385c910d31a86dc4405b7b30315b42e167677535787655e5c848baa15f4750c9fc22fd1819e017385b3ddd5b70b2687e0e8fa850f34333fe1f211a93088c92a6c9b6e4104e75397233f9351d80c787177e5fcb6c0f0e66beb2a723b0b802375672a6777994564599b5da62b0d6b5123cd8fd34e5b9afdad36b5e4f32a33eda152efdbed0107298d7c60153b2216f66baa3b8a41132baa41f0c3dca32e99c534ff225598a1864a79d305837215050644e863a75ea0cc3136a7662f31377ee15bf30db66bd5e1f7d0f0c5ac1ee292eb8445a88e390c7413739ce26c00292f3e74545ff5079b2972160a9d2b5bcf6f129f5eba83239bb1160b7b8d984e137dfae3cf315d8407dbe2b075bce5ee38a8eaaf7e4b5336bcfc1a0b7a8f7efb951b191d2f14b0f443aafa8f134de6668a699f5bf3186f9936fdb1f0d0f95a9727f5e9cab5af0f0830f19bae9c297be3d6b9e45f8f63d28d4ba4b7597ab3e51f2b0b96bf1eec23c1c75e38d7fa3e1bce89463c474936292e84ce048e92b082e93732a95dd2022fffa38b856c16b74c4f6528e5bc65fb5b1035dcb4a60aabd23c10553dcd4c3b77471e364ea60a35ac77b1f4cfa0c678e423b1fe6d09577f4f1302e17757ab569702a05bf8307378903b3ca6dc1e40d5c24a76b9d667d181e76eafa240a5e071bfa2e926d52e8298ae075d3f99726cbe07ffa38b28c32b905b818044eab2578d079692b1a615a3751cabab753c571c4c68c5a4a51f3fbb17feba109a2a031fde0a60503c419043c95e62fd410f526229b42b78790b8aa7850030afe5c703028197385107084dcb41d627060502b7f5ee301fb006c285242fda0c8b2ea882fa230dc952b80890f974b66b7eea5204d1b73f0d8f0f307eafdbea258a88230d0280282feb5691bd51ce4d679e74bc45e13ae35374638862b4c7de420df7618b408a613e6cd4c49cf4bcec449d8e1aeb9e68e29b47f1d0698635e36435c4feb5217c0c66a9e5bbb631ac86270324c9974e116f3309b4c43b854146e60942019dc65a512f2483a3323acd570dfe21e1658ca35c8bf7306613ab469d45a44c221005c0cb39de96f0fb9673e0189292b7e6abb72114901216d06ce547252f6ddf29a7aad2ec3ad48dda68d8d8b4e1f3224cc7137dae856a140683e98ac699c479ab83a074be381e661e5791ec3ced447841a63a5a11bf85f9e2572a52d486d0dbdba74f702810210032dd63bba08f1f1fe58e66a0c976dcfb895f4df6702aded32fed5c1674e41c893a5506c1699d0082ca60a0914e021324b617de4565b9906064871e55ffb482cf43782cd287031f2207bc25b8a45ee5cb255602012139a7e89b376eef6462d5473da6bc4c8104960d301d2db92f1cde00224cb0026bae0248217ee43c02cbc5a21e6f375bd34300293084272be156e96efbc8d5e72d174de3fadccaca0db1671c783206149095fa09d3cd4c12d3a0acefc8a098bca988f54fab0822457f949020a277a03ae58512042e30d26247bb1a0e738e689996b117a7301a1bbbbaf3c86dd07c2e49708b743c3081965745a0d53c5ae0ce3ca8047293c6a20f8ddba8b52094fc0dde08bfada6787bcdafe7cb414b087d3564663ac196c7176f4cd54157659c409d692a95e2063ff52a64f27755ab34a8d2fbae036ae8539dfad812b10d229ab75ae11cae187b852bd8efb9137df1d141e6db5a1afa85a5f1285f8f9131ba01df47e4784e7db1d8ea5f9ebfbb0f15672702527c3a",
    );
    expect(
      prover.toVerifier().verifySync(
        proofBytes: proofBytes,
        instances: instances,
      ),
      true,
    );
  });
}

void tProof2(PlonkProver prover) {
  test("Plonk proof/verify", () {
    final rng = ChaCha20Rng(List<int>.filled(32, 13));
    QuickCrypto.setupPRNG(rng);
    final instance = createInstance();
    final instances = [instance.instance.toHalo2()];
    final proofBytes = prover.createProof(
      circuits: [instance.circuit],
      instances: instances,
    );
    expect(
      BytesUtils.toHexString(proofBytes),
      "0372d045c2db11e957179b912746ed9a54535191d392299ee47996d37b5879bdfc06ad84f8f8fbf2db5dd89c89d4a5d3a9d0b95af1326458b41d974bafbdeb11025a8f987cdef31d0e8c24b4358574cb4038991cbb58e5a016c33a5a47c09e8aff11d35cf80c629cec0dd6b33717a6266c801ee62631e339cabd361b0320f4a647cdcdc00c99bc3c2ba13e62fd4752b611caf9172aa96b498eda8233dbfe9330df07af8f96947da6a4144308fa43b784bbd2fe178a7e2900af087203cc78680fcfe7a4f54ef602486b0a18f70b77c1948bccde9f23ca8a681a01cd46cc635530c6ee1db1f194152e276f2308e3b023ed300aedcfc0a9962607f1b9d9e32a748e6852e3b54710b9abab4cdc96a2948a3e70177391b0fa5e407cec6c6d3e8e6288d2548ae01e681b09526fdb4d6055f3f6f2974c89bf30674c9cb939b17f17101c2ad533b98969bba55a6d77542305de5f03027027457be3bbfd3476d1d9d2848588605e0f48baa6829b4ee216782894d4f475e3808d39459252bf0fb94c0b94aa6a06186c0125d6d0c30a662fa0b0a4fcbbfa0c649b6b27de464d7098c2adb7bebf29e840759766d97cb72d5abb49c665cccdce2ea1d0e509c5710acedb47e2346360ff46c87959c38138d8261e310976862368588860d2b39e47b344750d4891c7aff123ee4133b6a8268e751160bec1d8bd8638eba7789f74f92dadf7b0b8372b5fb0f4f9f320073786e1dfbd99d96bbfa8bc6d8baaa996cfb965842490c6a956d3ffc3e7a3717a88381489232b2388454176da1226f22641f45ecf7951d93177e66fd795968318aca7a39e15bba6ed7f23a0a888a4f131484b6aed3595c83f725153911c8f06fa6d641e05310b6067ff2836e4ffc0cb4229a9e29450c33021bb050b368ec9ad639b1660d0f466fc7de920e5d73e6f1c4f45ffb9aa9525d4b338027daa5b2cf3d5b62e4599e2e6e20424ffd4c68ea6026c2db6bcb13b85158c7219b7babb4a2d5ee8286cb811fcb818bb16669ce8041031500ff16d1d9d431055ac5b815fe15dcc9b99700d3a4a3a5392892e773f3d0bc9927add830b009b238b8b04e6f0ac783266bc6ba34a55472dcd4da4287895b647c940ad3eea9903250ffb24922636d0d0bd3855055dabe5e269ef5b3208ae382f866ce0e75370609881a492c68cf17063991f62676bd21a9c979259e86957dd343b4a9cecce8336a9adb2b990326357449adb995c0e41cf1dc9f4d26c9c16781169861f719f35de8f85fa8e954553ab90fbaa1c49ec74cefbe00c464a77e95b1df0555bb6fdc4379630daa0ee374ddcbd4c565067522046afb36e0055930b388ad3a9280361695e055a1eee78dab20a25e2c43fe69c4208a2a4c59ba8bc62cd829e0482f59ab055908e82ce59a5e6823fe4b7f33ecda18b05981d1ffb48905a5988831e6ab891b5154cf009fce2f04b42a5e3242d0501d6cf0fdef80ed03d044de9f9b7564076c02a7a32de40393007adbe1649d0df1f0c82eef5de57a60f07bc7c9ee97fe0cf8d0422cc949516489cb4864083bb7e4575bc1825d80e4de8ec7a60f31338dbc17b349e239469a2f9988f5e40e871ece38be81410052a9ed68cd64edd739d818ce2040c5aac6426c1accfd97c05c19fb2ddedf67c16c937ace3eddc6b2f3cbc32cb2fa4ac954d9db5821ebda07989dcc13b79ff028d7ec2b65b1432c2940e1c1df90c058165e0f0cb9e5e7cecd5c0c0947ed4846f8bb2851e7c0a2e629eda7f07c90781d792bfb71e465fb60aa3d01f5b620dc15b469c5b3a1f57cf89e5fae6dacd3610bb0fe79484cf6b37e47ee41339ed79f3d244782d8102e0e2c2bdef889acf1c733e24b667a4a21ab58e56e0af1f6b83d3aa65e20a7ede5c625a72b90907d835891d3ca3b2ca508e3bac0c77ff15bc4bb4f995af09e64bb379f4db30de3ed2301d1ffbc679f10de68f09ecc8556dde54fe3946785963ec613a1230974e13f22dd9ee9b3cea9100d48c52c5c26490e34b8d745c70a65f12c68b050f2e93cff73538fabb1939751faa51329a84ce05194efe64eb4d904006e6c82f1be6951e8512f2ac5f21fe59110f8cb18db2a7ceb99c2390a228f24635795106d84b5aa1ae1ac119981a213731e8196a12f2dcc4e44837f5a007f2aad3bdefbdbdb93efcfb024a313469dfc20d8e97f4e1de597d67d51dec5f31ea036119d0160573d70dc9285be4f243f73a209c1714cd1be06aabd1e0e916018c7406be1af12149963f0905a9be031848d6c1695d8d55685b5e4fdff79631468b692fee578365c37e1169328065bfc1f1a7cb47e0c10d8508361046657f611acdafcd20dafb01a09d37d23ea650d656687b07c331d4659144436e2e315efbabc0ece03c2bf97bf263ecd224ad2e0f7055d18f104614db370fd76e9e3a90740c3a5659ca193a7c0cdf34b935d03050ea105c8a9710bb8b7b2fc460b920dbba8dd0fd3e4557916198a7977a3b3bda6a2d2be1c4feac13cdeb01924eb6f72f084f4aa38ce41e8a1a66068b800d7078df3c86fea021a9180a7fd42e635357675016469f5c12e811a9af56637d282fc5e424bd6d6293378de39e6b5e7081bf8fc197a6c810ecf7ddf49ad593e5105337f06ca0e0bb0b35f6ebc3e202171bc114fd2eb2e65303a38b0916872e943ed2785547562121e613cc723e36ba40d8e9df56a379b4f1cd19e512ef0d76fa0528b37384b8b14584464c85d43cfc5a54b056cb02946e243a0517430d47e1820bf76139b5f7b88e165b8ff5497b88573e8bf047e75238a7ac9f4addd83cd8bb1bc276a51a76f487535f5bb2d2d6d40de9c78dc073f431ef02c43f28fe393fae05c5378644c9597ea3c7b0f3683ba3b47942721b129a9640e52cb1001b59eec3045c9891fbfac37b075bcf2824f3b61a16d83cbf97db730d089083d32a029e28165e68752ddae221751a0f2243f2eb316ee8224dd938b57988015ef55c3d40aa3bbc2cdc73f3d5a8ecb204a89bc4f25e855d710ad44c8150dcecfb479c796b82388d663e28628839c9a81f13740937fa9b549dee8088f1d9a5ec0ef9bc5646340a001313058dfe8ce24e5a7a684259b7ecbcac098e5d324c23cf56ed8b2c6ecd0fb0375319030bf7bebfa3868a559165824e640884af6552c26876f1c9f0db9208ee28af7b00c5ce4adca6c5747955acd6142ed47fcac95fc95a664dd24c4b9d098d5a8ca6b5dba2afc5a404605de2ad26346b718f94d0c4f1628c79266bff181e6434a210a3bb25117651f676264ef2a9aa6c2105be1b9b1f2934f90e82a7221c21e7c7c13846b9ca30169d6430d40a65700ebd0af95d6958ac9258264674ca0541f79cd940e59cb2604e276763bd9553481a4d4c8fa8df87b031dbad8dfc2b15dbb5bfa6ece0c262bfc9c42da3bf0fc76c56fdc2397cc00566ef5fde20c33b2085c8ffe471418c0a74038d6cdda0a4c7e15932af03c7728ab142d10bdfdd8308a140d4a6a69b16d7e1f127a74be69c33afdfec827f3a983bb805fb5272c3f31c2214c9c08fb7143c2e49051f37dd34f01248feb896559c5dda4527349d3dee3b096d25faa976dbeca7f2eeb6bf54d149a3f8ac8052533bf5f64aeabbdc8ca125de44579142dc7a158f58c225a9e537198eaf946ace5d404da01b688562c0e0173664c77361084ee84c12bddd43f263ac5380441221786701b4320d5e8ebeb732bc037e5d0cc6a1fea79b8851011d2f0b7e6424a0bd5568eb4124fd62642a3f0d7bed80d7e963f163008fae0921b1188f9a776b432fe71653aaeca4aedcc3e40e9f4e35b880ff6a9bf892a3a6b2989429f425d0dd68f8a852aaf8b273193d0b3f6feeef9e1bebcba52e62aab892d9c9006a51cb66cafd77fb47b08a6ed5b7ff32901d48c5fdf708e5dedbf7a8cd3fd8d454fb8d0d2c479a444df71ad7acd9c63abb3c6d5d3353390b8b460937ebb664151b32bd23308ac79eab3e10e09c8c0528508d63846c1aa3748aa54616cecd4e005ece3e0adbc945017ca2b622768c530352953a0ca26a362c153b37fb667a8d420bb4bd8792afee928b618e1b5364e22972e95f1afc18698703f39b61f0b321774481b7ce08e5cf3fb3d387971c91a12e1f8b04c05cdb1320e945b11cfcedc6146b73b70fc82f394c8a372f9953571804acbb922a5582dd9af6e2df75c87197262210e9f3f96081a5c6ff27f16aa65f07994088abe6f1ef6c56b959ae2ccc3e052de70d95846300e18d1b1761b194630ae9265f72a5bd1213b1a4d9bd6e13f81b962cecb52d0b6540c2f20edef473252ab12ec9f1545b4af73e46547e8625cb301755ae07c55c8014c15f1b117ed48e1182b9141d9caad99236c1a98b1080fbe3bb6573f1d83f052273b083af0e888320a5c722d1624cb830f7217fe8e8449dddac1ca119268fc483b28323e03ad35007d8a423009141c75e37be95d296dcbcc6f484ceadde61bc5b5116f0b3e5212d21e96b0a663e6def100ffa16996d015ef8d43d684e736821cbef110ac39a91353c159e143faf3961ba67b1c964b1dec17d1d5a83338be8c3d093f6b43adfe04f1903717a9f13f3f31bcda8da27e8354497db69f57f543ab50d14e545510b85f01cad545eebb2d428cf8ce34e4e77a79ed1b9ffe5848f73c85c1247f89c02e1df1ad6d1e785a89a4d4b8460a5607e19191402db6a70ee4d2d882c376b0b4c214d00e2ac64de6c7da6bceb19865c16984c55ba64e89d2da39ca886fe60de49fdd339c19f208e474c2651a21b3fbe69cf60014e13c079d25ed8316b9c1362dc27033cb9dec45c002f64649d369b4082343646271139fc7075db649c024c532b55ce365133b7877b282a10340743a5b2653c35b9c4258cdcc27b802e6fb7477d58822763d848ee39d555d207f3fbf87d3cb1eb59c125d523b87ea9750d810b4f65c51e7e730709b81403c7ed3bc703202ff2b82c773d8b240d153de6f9325de381e5193fc9cb6af55a818812751414bf82a96d93d0ba591c9cc45069d0d279b9a2003c534c44f676ffc438b063a10baef915e109d4438e89ba4651aea6e992e822e4354d56829f0620a1bcd2a9c6b4ff93b3a44604a63f3c549cd6cd5fc80cf4aa2205dcaff4ceef6edb3565bb14855c140b7f77ab52f8d8dcc5bde9b24483d838e703f56c87e7fb63812046b7a0e58814f22fcf32d32bdd6127a593a4e7b852b0562c69e9c565dd764644f17ddd15961cfa598a9d6947337ef10ff6f95c890260fa1015631c751f0cf15d8c5c8d5452b2b2e260f405a1355c597c2d84296863854d1a9a9aff8cd2b827b8e31f6e3fb55480b7847d0c24dbe985c30404b484b828c909d1b57adbd4d55d0f25e0c754661171e3c0cbaffc89661dfb511e07c2efbd930b1320606e4f90251ccf46710d8b54cc06a36133477d07a77889f474dbcb58522a038c019478a2d06197b899e7b6877af7ec65c6a18b3506462507a2c3cadc37080049ccdcffb812a96bd7d97ab447bd584f9bfae9622174629079db9cdc9757102c06fd92d2254793913a12042648bb58f0d4e55f98d7a858466b42857d153f16c46f01806d13d7fb74b4d82dcefdfb4db0a313d10add0117eb2a24acfbcc192bdb03222f8a085491600513164307ec0823170b0d6ef44ec11d73a3dcd16137237f4a9504edbcd6685b57020251daea058e18ed2717fa65d539f28a4e9395a02070e048d530e39b6c6a7c02598581122f73c9de88bb45188a83e7820d8d45b11a032e9932ccebad3c7f0f68829fb4e4bb775f4afbf5da2fa0012b661b577db309e09a14030c52f8625cc4a3c0ab6afb663111dd285a1ae142074e1267dc04de044d1cbf9357a683bf27cf228da22c826143347ad69ee7067e46f8231c86587520dba11f0c860c7ff8dc8af9e5160e3b12a5656249238ba5e780386bf69d5a6b2eaf9a9e7c8d8f05970d02f079da94d1fdbb2744e5945171d51da1e395036f141350afaac9b408e8fed04bbb0d5da5e9f5e00b6919dbc28e67a854b1e98a7d752758a3555f1cbbb30acc34e2890ea0a285263a719db27568509b8b62aa635957306f6e1f82013d29ea7b22897f172f0746bd9d2e1a0fe26b08322eeccf0f3ca68f3e15901d300517bb9ff6b0e7c5e28bfab0eb234b5f323fdb8bb98651e9153e91bc841b26e30da75af81fdfa6aeb92f08c9aa252507f21d6dcfa77d39b2a1671adec9ce418198fa770a88fba5dbeaec7be922305484fd4ed6dea5bf5660159e11d45abf712fe3d1ba2b776a21ee0739126242f66cdc737c277729467b16086eb53b2dd73a5da4409ada300bb1a1d14fa97d61828cbf2f640d23d9896c91f52eaf47a0e9308d84f4461f03847f6fcf5ce0b83a7678d6688b3af81494533ff1789e3da8b3595c8a7a10f34bd7100e784bb92d694512e9601690c86051a68bc89e0ce230589545894d571793d4fb516bc38afcea04cf885da250502db92faeb9ff32acb3260f87d8b701ba7a9adb7c2334092be48d3d8f7f99bea0d007a61020399a3a1b6f771ca23625776a1631b8de159a462e7eaf748dfda74a23c93c47c0df1f48433768eb9e93a4131fcc82967756ceb8ab230d4c9a3b324896779207f03c8df88d6b7b4f48fa77bcea9de2336b6513df835eef759e0913424014e47738889494ad0cbec58fe2947180473ca98c25a9403567f228115b6ee6cd36f2ba3af9ac31640050b979708566e4d19f8afe72874704977a970cd713b774408794ccc18168eb8bf3d84c97ec662ef9bcd56822e1f43213fbda00c31f44aa645d68587bb35bc6f3d075af52d2006ba87c641708288d57660e719e57f7a61924e7f6e0781786b6e3708705a7c64825c07fe4eebbb2bcd10913bc65e88a3b5b22d47f90cb9c0822702d8c31ad3f84a52c266517712b71281fb55331063addfed547ea695ebe5cd153987d1522a43951e302f1221377b79d3d943cf11cb21c5936bac4514e2a83c686e453e75a18285dfbcb974906118c3e707778e4ae525f08f88d321cba9864061a0064da35fb4931ee8630ccd5cbd0c7269ee47d9c3d9357153f7b7d4c34724bb8259ebc67b9b5894bf5328385e4f0ceef752cb149bb78b81cb42a5cba0d",
    );
    expect(
      prover.toVerifier().verifySync(
        proofBytes: proofBytes,
        instances: instances,
      ),
      true,
    );
  });
}

void tProof(PlonkProver prover) {
  test("Plonk proof/verify", () {
    final rng = ChaCha20Rng(List<int>.filled(32, 12));
    QuickCrypto.setupPRNG(rng);
    final instance = createInstance();
    final instances = [instance.instance.toHalo2()];
    final proofBytes = prover.createProof(
      circuits: [instance.circuit],
      instances: instances,
    );
    assert(
      BytesUtils.toHexString(proofBytes) ==
          "65cd6ce2808c8c5ae01938d8082bade9ac9f2eb0910c131dcd6fbe866473cb83d52f048abdd92cf001b9a765f6bc7886cbf85333fa8e5cf7bbffc8221f3ce73228495d2aa971084f4670828588a467b71db3ad65cd350e886ecc169aee1e5db08f1c21d7c2725715d475a77ba6c60d350da443e24d3eda097599410abd8dddb0bc8ef5eba992b015a19a1ae8e75608f66d40762f01212a4f7f33d65ee850462d51b633617686d0413659610968d67303abd592a808752c06ea1546d8c8cd33866987fbf4ec3f419040c0cd06b189e13d81907cabe7eb297081dd48cad02bd517ba889f5679f7273eea5a2b54ae3d97278dd77ab79a231f2508aea4bdadf03d3e9bbd1c37671f0271904cfa7d8e364af19333361499a79a74d56678a536a175a1fefcdde323a5ec3e2eb6c5bb7e17afb35887c8c2075a3a2b1387e96cf2caa69053335092555c733c923c270d85b4e0742881f01fa101e62b764765ab1244ea05eaabcf7c17f0d44c82e0075553db3d0acc7a303b1aa1b4df09488d89e9aa513bcf7ee433cfd5fbe809521cc01c1410462f92f70cf607fe3e1885b89ed64f56042047a2cc69f50a0a7b3f3e5b08b5ef63b691ab5c5262ebc0d3117779c72df98347584e14ff25687499f7ccd3b16490bffa68a94c21d4f15e847fb360efadd910dd059ba2aadac6081c9260e2ecf16dea25e89453cf04e85fc3c55af71ddfc818de8097b08b597410b07cde5b5f85eacef7d14e09a8938e202b7318707e028f05c9e0d4d1c7501958ef14bce3759e486bb31d552387a2844d382d83a7db62e68ea9cbe8ae4cc461423226c6bc282591d3acb22196d4ef1107e96739ac53eb929d5e3777e5c202d3adac62cf2f5de201e0f8f42d3ab2196f00388106de78689dadfe96db3c0cdd64d53fa48c8f49fa56d62fdbeab1b576d8d85a00ea4bca44b7a5cf0499b29d3752d2bb0d5d204de92c671697f621fc0ddb1a66f707567292b00e8f3998cdddc1a66e432f8c469eb054b1cddee7d3d23887509aa4898b35d74f3cd17ce306db2e97d685f6b880fb57cf0d68321ec17054107135a4f3cf5f55b218211e0ad6c459ff42c4be7f4531cc8cb16d6c8c06cba3a3b183208d04ad073c270b7c0d3eed73fe2bb1011890b0cd39cf445939537c3224461361cfc60469fa1f97e9c86665fd8ecbdf2a15586bbe9f406b15037b58e35fd50e5dbc2105f4faa254e2db4854330c30bfa577d05b20196a69cd2ccfd94a60fc34f6a3740bcb1c13328b3d768e0c923ef620b6e4d0ab3dfa679976dc825467c6fcbb14f0a602a0bec017d9f8f59a6e00fbb6955a7d44c8403192a7b417af4071da80bedc48148397104a1f6e8cb3ec58d438a7eba48f0d727b281c66600eea1e2702cf82572692b98743ac3e198362a5b1fc5f4ec7774c800bd0099c6497c972fff55795bcfe022105edb54fd02e29b4adcea0eaa07bdede28f0db50f7aca181716ec51dbfb6350870aef5835e9e688b8945d9e2392c37902c1879e3e7bbca8d2dac907155bc37360897b53c9dd67e44f4aef2a2ae86f372cb7c671b4c86c29d098a86d9eb7c2c13fcc4e52ec106df08e0515ab1a155fabad2784fd5c22ca0ab01e829ea497ea431fc080b443c7159a132f3a43293d99b3a7713a0611cbb370378747d20af08de0ef82b81d79237ad5eb8e295259c53020f84288ab54571a4de0dea4d475f0e5126ed9b0e75de9d7f31ae022800a38b4a15b6ce5718326715aef0185fb3d7977539df2ec84d2c3020f1c174a74c1ff0a9ce0ad717bc174323418563e0e7de9fec2847f17a270fe924fa58265f747693f0bcf344cb6f5366f376e22653f604409e3515d6313e728b5a798cead52798965f0e3caca707c794b03a83cc80986792b130f102902b8fa03b949e9c51f25352a597ae36738fb7111b64b0747af6086b213fdfd95a7a85bd690931f6e4aadb1f46252e81aa2800eb7edd45045bc8af59e818db81b637abf1495e92f513e47fd9a97be6baf448ec09fbee5030507a0dd2e5141ebc92a3e42046c79736191543982a9dcf9a218d41eddc8f60d34e5636f68e0c9b88d87c97240567ed0ff84c3d7eaa04ea42609538488f34706ac70b5c26231933bc05e536f3cca9411509cf19035e1e49efbfd081fb88b662c859015bb09f13902d69d6702b77731b35c1223b4cca9ece7ce03518e8b95abf64b447838ca53deba63e961a2ca53c2cd8b902a8ce00fd78d800a029b02fa58bf34032219ad41b292ffdb3f43b8ed575485a8ba30e2986b4801fc26eb4c3fc7f8729caffb9cf304ade41af8dd6283e9c625b8d24dfce5213a42ef5245a9e0d34d49cd6b7fc9b23aa7c3242a761381b38edcbf328c1564fa0e19ea96a6272067f21fa224f75261307f96ab93cac965e2f67d3de6e931e8867fcbca816fae1911284ce06e8bd6d0bdd6707ab7dedbe89be6d1dd888feb183a1dea65c2f270b53eaedc142e9c18e0fef9a9ca71f2149d1d4ef653d3fc2576b5c4196330d60bb9685e56deb8f34ed04663476d7d34bf9d4f9164be1837e05a4a1d580e190559c849640279cea366b216483dedab1da054a991c5c68967a23126daf5df75ba34fdb59ae4c85a2304b35ef57e41e8d3f03a6b375a8a68a10f64b2202e8f6f07ea6cae5bdf4e4362c0000e944bb1f30923ffeab2e06f9ca9930a963f754555bc46301486feef4fe8c1338a38eb3919b8cb616e47d71b114250ae85ad9d76c6d4ae9cda19ed71693acd532107bb72405c8ea8766f0fb0a067932cd70f7af3ce74ebac9c2365a107a931f287ab2f3ff71ec66f2ded5587840ae82dc2bfa898ed6919223af6f95e455974a3e227edc941b5a7fcff76c904e10c113140db4087ae2d66c9ef4999976a2beac29248ad1b1c391546d43c13b83fb7f49e415a326d1e1e91d35e76141d7299b8c2f50b96ac64430bfd8a73a1db71b47d90ac9546119484cddb023b24d10b238072b67876b471f48020b5c511d5d68d35d931a458a49de1394155f73ce5f689fc40b291be60d78cf097f8de6e15ac3ec77b7f842ad1af25f4ddb36cefdfeb0e42423a0803d6c3f55a8cd7780f8986fcc1cb19a7e6c3b358fc3f3981bfb40a054150d61e20ce9304c0729e55c057c0791a5b309ae5fe4863b19fcdeaf0111bc949427ca4d0f291f8e8f062e2872051c36d714f7dc067755abc98fd1d60a3ddd803b1778c07b6b176e72e326244f6c92680350433c9ff066125767bb707493f9050e009e7a64eafea405fee6eb4c5c781d59fb225151186a66080a1d9c32212e9da72dbdb40a83a73eebbe9ab242715145efb55a27cc82a0bf8935e5c30b1db7bc2f2aab19cfbd958814e856798c61aedae489d3cda553427aa7e7379d732f86bde706da8c6f93e01e30f0c0d4642cce71a0fbe3f1b4a1785f7017c71623b5a61b890d54a596d6809470ca27aceff07f589c56fb510579dedd63fcacc9df2508543630cb63a772e7c1efbae377ff48315df50b303a9cbfb45f825059ce404c875c591dab3ace191cd9d1548c83392d3cd7e6631c26292f2455608e4ca7b1976a6aca344a26cf2a471174d28ee08f789a9453eb53ec28ea2bd51a3c3cfb2f43b6924f34261b23138bd9b4418c9466c4346eeecf7e6cabb1ce63d3a487d0be10e8b6183c481d02ac0af734a9b6eb68ae2278e86726f44c4d7dea6a80d456f4b5d5cb2d20247fa4f3fa4043a775afd8afd72a1d3a8e60998d716425b6442e64c78938d01d4e9ff9d832333ed3e34cd0d7d0c8cfd516c0ce5aedd9cda2ad54c27a8af77313b663f057e256639915cb25f53894a1d1922997acb8ed57a065e276fd6df8481308f60c84ae434316c691348d88ec5279acb1d8c673edee94d35f82b3c968862edc2151fca188ecc58d86a713493c8d76f72d6fdbd0363e63f46c9b71e463c900dc176f1c81e7c9c3bd3afc869950be425c391ca2aa50aaa449ddd4bd7f57ac3371ed31aee005309a492e59f61faf22bf3b97bb13b2c8bef38f986accbf3e1f178d33b499572ff7db46e5a2597e2aef06346cce146433cb7754cc0300607b19063ffc3d9e81f8e1f252c25e96ac9dd62c9afa28eff173ba68e2567aae8035db064ddd08a79a7351807cc86eadacc6e7f79c911c2aff4295fb2d41a8ccde928b18b3b7cd707811b3a59c59fe9c7e056cf66e10f98ae210576e582cea8c4fdfca2bb57474442c9391c1c54774517019208ddeb41b6ed1ab74f39d00d60cf0903f36fd09325d24a75322b03301ecbf84be40855ef2883aae319aaed814ebb44fa533bbbc86ba2cff1b0d61f03dec6e52f5170333d1ae2be35364edc2b5e4f00d2a3eda47152497ea3975e21b5c416ecab8ea339607e52bce93c3e52b59196c798018abb077975fdf85e5fb5260bd8ba91585e187303e05f3fc9b3ff7132c7c140c28391110e605e9e9c6ca1a042f5f2125c0948fc912b1ff1796d9bd341d8ee8b42e8d43f886a88e3cb80fbb5b513160c57afbf0e0321fdd8c7496bc5577d3ef363e460b5caa6b360643e603c0d7ebd74723f6571dcf1bac91e82e3df07b791b9b1f715a42679cfad24c8ee09623864e8cd831d4c59948e4b9f1dd251f4bc43a290b2dd2b47869c97e544c33bd4acdd45bb1b4ea1a866fa846ab06f4ca149717b13e2914bff7fab39b7cdecc5bb402cf6b0188498b5e2faa6dca6deb36d61b5a76143a43e7c909d2a6f11acca3aa61e7943ce1e57368327146751a280688e41520175005b4f6ef366948b822e220cc285197caa6b60e6140f89a43de083b9694c6123fc2cf6f355fcfbee7654f3ce65717fb7107bd19edb5d00414934e389a96d33cc80aa3b7a225fb40b0cb029b0fd01bb69e556c2408f20a02e3037518cf19df022c18ecd07824e8b2f858c2da5dfb01c8adee2ce288e4484db4bc97f7971a26033a824e060670d8cf3a7eebb803cb197e16c4b19edf1813bfbe69d9ef37f21f3670dc1b3368337b41c9083eb9072d423d7023cb711eee5ff6c3c71e00f74d613325139b0e02b6264802df544c18b27c32f744939ec3fb36d834f16cfd6fbfd337eb0db5b6d8486911d9098e7244a6910a8890da25bac155f119cbbdb320df3c0958af670c0a41c625beb84c819e45d665cd27a60c3de3680e3cd193a3fb4f4713556671cc76a8ac2cd072124db29c9ebc3460bbaf21149c86971802816d0340231b588f1a1daa5951e68f1ca42a2e9908caefaf00ba95cf8433acff798b64c40ca7d7bba6a9fbf6168cc8fd13befddf2bcb6995f4fef3308f752f639921e5e839055964169f70a49b4c1a7f8267a83f3037e95a14d3361ae5b229bffe12e2d2355cd8d8d42f1afc7ef652ba8d106b15c22fae10748a5b007a4ef119eea2921a1ad9ea72c9e2005ece72477e7ad0d0a9ea63586b99a704f38fb17bef0b28ee2732ae5ad7a4a40ed8418afcf2834bc5fd939c51fd2eda652aa379de21057f81112f0b772c441fb47287be04f1d8b140d550fdf1c26fd6d1ef550cc58d8ffa2762016aace9aa65ab78494dfd1b6fcf38267331b715d8683434f042825e9338b5192347f4ce4dbd4a5f5e646a060ef9d19de4b10a18bef1ad8a2c8df03ceb96c63906360d2d967b41866f354b093d87dc690c619e7e473d6a5f478ba173ce4e00460da021e810b927eb928416790370e89edc05fac91bcc3dd8ea5452abd91309041388fd84b3243f17d0220258352882abb05cb2e20355d3a5095eda738be04fde0b0afbe88a16d98e36b921cfdc78ba9f5c2d69faca5678af649683592fe095a922191114a85dc08c6ab29c4e854730ff9473578a440fd17a09be497e76443580143c5dd76f6895c8ab72cd7ffb53aae4013c4aefb753f28cc0f6ebe4a141717f3315e20568b76ccb09cc569479417888cdba9700ab6e43f3553c57754e3c7eec361deca1c5bcd179dacfbe604553184dfd2757e23830806007389c393fd6dc2c05f91cb44b8a9db43ce1a3a9da5a101f220f83f9cbebb32b3a008a753aeb3070a9fab35906f19057ddbf6a5173c59e5eeec83db6cf6c52a4e71c947d79f8f0ac89d55de3a800adaac57ebe4b3fd548f5da35873fb15781d07a483ae3d3821f0f100a832b0efb01d208fd0581b70a1f3e3bb1f62fd291efbbabee7cfb9ff436a72ef4f5f7ff0bb7b13f3eb3c39a0995fd7192e7775bdf1e5faa301f7e5bb03c4291f8ae22ffd9979da48ae3ac3860db7641585d98ad4094c865aa767630a078ac304ba1239065fab93acd2381d987dcb9f9ad850fb61ae7d0c3c53c38af80497810301ab83c6f4adc2dc9564b1d9476bc5a0859178b51be8c5999b95c70fc9bb42325c02420e1cce7432cd1fd90f5268023b647209826efea26637c523b6deed708a0228707bf7da17e6b35ff6e099384a82a762007e8c1d81956d314f3274b313d3ff6cad77ef888c98080639dcf953413661b484d33a64d63ce6c21bb8700043760bae1790d02d0fd632945e678fcdddfe1934c0600cd5638fdb2277431f9be986ba550df372e9a587b20c338354d56e9a754083f0cfee044ff76490b26b384870cdd417a6bccd35f30485a1fe8387da98ae79d584dc989aef13e4dfe9766618759cceed129982304225aa4d04f322916df08597b4cf6706020c724838c2854b87c0a0502e6de6b1e70058237f752666323dd2403818403c95fd2d856acc16cbf37686708bff47b0cde7bb4cdb846465984af1a10f5bf18c7691fc0159401bf09d0e7866bce439cdeebef332d24b599009bb1324852c8f53319ec43cad2ac44b2378bac1932f90225b307426cc7a03a993eb991f797ed399eca30b32146d77786e8fca0bf26441b6e722eb0c0d2b7596c062433e0747efc157b130cc100f182187b3dd6b6432883346d346eed5cc628e51408dddc2975706f658d838efa53269667f04ff7686d7d59ea1879b4c8d5d391ed71897a06d323dd126e9f4304bc75a49b6eecd65c14988a3c4c8fd05e6857ae42bdb4d7568082f89d88204bbaa61b37c48b05b531d67c88664b72536cac5281224663da69eefcf81ddf718dc7ee40360ff22eb3207589475ebde148e34cdb59855e16124a396f8c902ee05c89c0e912",
    );
    assert(
      prover.toVerifier().verifySync(
        proofBytes: proofBytes,
        instances: instances,
      ),
    );
  });
}

({OrchardCircuit circuit, OrchardCircuitInstance instance}) createInstance({
  bool enableSpend = true,
  bool enableOutput = true,
}) {
  final context = DefaultZCashCryptoContext.lazy();
  final r = fakeNote(context);
  final fvk = r.vk;
  final spendNote = r.note;
  final senderAddress = r.note.recipient;
  final nk = fvk.nk;
  final rivk = fvk.rivkFromScope(
    fvk.scopeForAddress(context: context, address: spendNote.recipient)!,
  );
  final nfOld = spendNote.nullifier(fvk: fvk, context: context);
  final rho = OrchardRho(nfOld.inner);
  final ak = fvk.ak;
  final alpha = VestaNativeFq.random();
  final rd =
      OrchardSpendAuthorizingKey(
        VestaFq.fromBytes(alpha.toBytes()),
      ).toVerificationKey().point +
      ak.key.point;
  final rk = OrchardSpendVerificationKey.fromBytes(rd.toBytes());
  final outputNote = fakeNote(context, rho: rho).note;
  final cmx = outputNote.commitment(context);
  final value = spendNote.value - outputNote.value;
  final rcv = OrchardValueCommitTrapdoor(VestaNativeFq.random());
  final cvNet = OrchardValueCommitment.derive(value: value, rcv: rcv);
  final path = OrchardMerklePath.dummy();
  final anchor = path.root(
    cmx: spendNote.commitment(context).toExtractedNoteCommitment(),
    hashContext: context.orchardHashable(),
  );
  final c = OrchardCircuit(
    path: path.authPath,
    pos: path.position.position,
    gdOld: senderAddress.gD(),
    pkdOld: senderAddress.transmissionKey,
    vOld: spendNote.value,
    rhoOld: spendNote.rho,
    psiOld: spendNote.psi(),
    rcmOld: spendNote.rcm(),
    cmOld: spendNote.commitment(context),
    alpha: alpha,
    ak: ak,
    nk: nk,
    rivk: rivk,
    gdNew: outputNote.recipient.gD(),
    pkdNew: outputNote.recipient.transmissionKey,
    vNew: outputNote.value,
    psiNew: outputNote.psi(),
    rcmNew: outputNote.rcm(),
    rcv: rcv,
  );

  final instance = OrchardCircuitInstance(
    anchor: anchor,
    valueCommitment: cvNet,
    nullifier: nfOld,
    rk: rk,
    cmx: cmx.toExtractedNoteCommitment(),
    enableSpend: enableSpend,
    enableOutput: enableOutput,
  );
  return (circuit: c, instance: instance);
}

({OrchardSpendingKey sk, OrchardFullViewingKey vk, OrchardNote note}) fakeNote(
  DefaultZCashCryptoContext context, {
  OrchardRho? rho,
}) {
  final sk = OrchardSpendingKey.fromBytes(
    bytes: QuickCrypto.generateRandom(),
    context: context,
  );
  final v = OrchardFullViewingKey.fromSpendKey(sk);
  final recipient = v.addressAt(
    j: DiversifierIndex.from(0),
    scope: Bip44Changes.chainExt,
    context: context,
  );
  rho ??= OrchardRho.random();
  final note = OrchardNote.build(
    context: context,
    recipient: recipient,
    value: ZAmount.zero(),
    rseed: OrchardNoteRandomSeed.random(rho),
    rho: rho,
  );
  return (sk: sk, vk: v, note: note);
}
